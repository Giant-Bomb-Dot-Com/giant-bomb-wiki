--
-- add mw_page_name to the tables with a name field
--
USE gb_api_dump;

ALTER TABLE `wiki_game_dlc` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                       
ALTER TABLE `wiki_franchise` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                      
ALTER TABLE `wiki_game_theme` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                     
ALTER TABLE `wiki_accessory` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                      
ALTER TABLE `wiki_platform` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                       
ALTER TABLE `wiki_location` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                       
ALTER TABLE `wiki_character` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                      
ALTER TABLE `wiki_thing` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                          
ALTER TABLE `wiki_game` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                           
ALTER TABLE `wiki_game_genre` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                     
ALTER TABLE `wiki_person` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                         
ALTER TABLE `wiki_company` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;                        
ALTER TABLE `wiki_concept` ADD COLUMN `mw_page_name` varchar(255)  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL;    
-- copy name column to mw_page_name column
UPDATE wiki_game_dlc SET mw_page_name = name;
UPDATE wiki_franchise SET mw_page_name = name;
UPDATE wiki_game_theme SET mw_page_name = name;
UPDATE wiki_accessory SET mw_page_name = name;
UPDATE wiki_platform SET mw_page_name = name;
UPDATE wiki_location SET mw_page_name = name;
UPDATE wiki_character SET mw_page_name = name;
UPDATE wiki_thing SET mw_page_name = name;
UPDATE wiki_game SET mw_page_name = name;
UPDATE wiki_game_genre SET mw_page_name = name;
UPDATE wiki_person SET mw_page_name = name;
UPDATE wiki_company SET mw_page_name = name;
UPDATE wiki_concept SET mw_page_name = name;
-- append the id to the duplicate names, leave the first name without id
UPDATE wiki_game_dlc AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_game_dlc GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_franchise AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_franchise GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_game_theme AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_game_theme GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_accessory AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_accessory GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_platform AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_platform GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_location AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_location GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_character AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_character GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_thing AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_thing GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_game AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_game GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_game_genre AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_game_genre GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_person AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_person GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_company AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_company GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
UPDATE wiki_concept AS t1 JOIN(SELECT name, MIN(id) AS MinID, id AS CurrentId FROM wiki_concept GROUP BY name HAVING COUNT(*) > 1) AS dupes ON t1.name = dupes.name  And  t1.id != dupes.MinID SET t1.mw_page_name = CONCAT(t1.name, ' ', t1.id);
-- remove the special characters and replace spaces with underscores in mw_page_name
UPDATE wiki_game_dlc SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_game_dlc SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_game_dlc SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_game_dlc SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_game_dlc SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_game_dlc SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_game_dlc SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_franchise SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_franchise SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_franchise SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_franchise SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_franchise SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_franchise SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_franchise SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_game_theme SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_game_theme SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_game_theme SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_game_theme SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_game_theme SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_game_theme SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_game_theme SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_accessory SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_accessory SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_accessory SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_accessory SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_accessory SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_accessory SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_accessory SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_platform SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_platform SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_platform SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_platform SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_platform SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_platform SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_platform SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_location SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_location SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_location SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_location SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_location SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_location SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_location SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_character SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_character SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_character SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_character SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_character SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_character SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_character SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_thing SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_thing SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_thing SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_thing SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_thing SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_thing SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_thing SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_game SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_game SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_game SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_game SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_game SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_game SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_game SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_game_genre SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_game_genre SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_game_genre SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_game_genre SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_game_genre SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_game_genre SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_game_genre SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_person SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_person SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_person SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_person SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_person SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_person SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_person SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_company SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_company SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_company SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_company SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_company SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_company SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_company SET mw_page_name = REPLACE(mw_page_name, ' ', '_');
UPDATE wiki_concept SET mw_page_name = REGEXP_REPLACE(mw_page_name, '%[0-9a-fA-F]{2}', '');
UPDATE wiki_concept SET mw_page_name = REPLACE(mw_page_name, '&amp;', ' And ');
UPDATE wiki_concept SET mw_page_name = REPLACE(mw_page_name, '&', ' And ');
UPDATE wiki_concept SET mw_page_name = REGEXP_REPLACE(mw_page_name, '([a-zA-Z])[\'\’]([a-zA-Z])', '\\1\\2');
UPDATE wiki_concept SET mw_page_name = REGEXP_REPLACE(mw_page_name, '[-—#<>\\[\\]|{}~\\`!@$%^*()+=.,:;“”"’’\'?\\`~–_™]+', ' ');
UPDATE wiki_concept SET mw_page_name = TRIM(REGEXP_REPLACE(mw_page_name, ' +', ' '));
UPDATE wiki_concept SET mw_page_name = REPLACE(mw_page_name, ' ', '_');